"use strict";let app=function(e,t){return[app.css,t.appkit.router(a=>[app.navbar(a),e["div.container"](a.routes({"%%":app.views},{transition:t.appkit.transition.fade(t.appkit.loading,{time:200})}))],{"default":e=>t=>[t.p(`Not found ${e.path}`)]})]};app.navbar=(e=>t=>[t.h5([t.img({src:`/${(config.logo||{}).src||"logo.png"}`,height:(config.logo||{}).height||"",width:(config.logo||{}).width||""}),config.title||"ERM"]),t["div.container.clearfix"](e.routes({"%%":app.pills})),t.hr]),app.views=(e=>(t,a)=>a.appkit.http(`/api${e.path}`,{resolver:app.views.resolver(e)})),app.fa=function(e,t){return(a,n)=>n.appkit.icon(`fa fa-${e}`,t)},app.css=((e,t)=>t.appkit.document.css([{".error":{color:"red"},".pills":{padding:"0 .375rem",".btn":{padding:"0 .375rem"},".pill-selected":{border:"1px solid transparent",verticalAlign:"middle",padding:".375rem",color:"grey"}},".order-dir":{ul:{listStyleType:"none",padding:0},".order-dir-item":{padding:".375rem 0",border:"1px solid transparent",cursor:"grab","appkit-icon":{padding:"0 0.75rem"}}},"appkit-list":{fontFamily:"monospace",whiteSpace:"pre",color:"lightgrey","appkit-list-type-null":{color:"red"},"appkit-list-type-number":{color:"green"},"appkit-list-type-text":{color:"blue",maxHeight:"300px",display:"inline-block"},"ul, ol":{padding:"0 0 0 20px"},label:{fontWeight:"bold",color:"grey",margin:"0px",verticalAlign:"top"}},".CodeMirror-scroll":{maxHeight:"80vh"},".fullscreen .CodeMirror-scroll":{maxHeight:"unset"}},config.css||{}])),app.btn=function(e,t,a="link",n={}){return(p,i)=>i.appkit.button(e,t,{buttonTag:{disabled:n.disabled,"class":`btn btn-${a}`,...n.buttonTag}})},app.pills=(e=>t=>{let a=e.path;"/~dir"===a&&(a="/");let n,p,i,l,o=a.match(/^((.*)\/~(file|dir|subdir))(.*)$/);o?(n=o[2],p=o[3],i=o[4],l=n.split("/")):(n="/",p="dir",i="",l=[""]);let r,s="",c=[],d=l.length-1;l.forEach((l,o)=>{let f,h=`${s}${l}`;if(0===o&&o===d)f=n===a?t[".pill-selected"](app.fa("home")):app.btn(app.fa("home"),()=>e.open("/"));else if(0===o)f=app.btn(app.fa("home"),()=>e.open("/"));else if(o===d){let a="dir"===p?"folder":"file-o";i?(f=app.btn(app.fa(a,decodeURIComponent(l)),()=>e.open(`${h}/~${p}`)),r=`${h}/~${p}`):(f=t[".pill-selected"](app.fa(a,decodeURIComponent(l))),r=`${s}~dir`)}else f=app.btn(app.fa("folder",decodeURIComponent(l)),()=>e.open(`${h}/~dir`));c.push(f),s=`${h}/`});let f=[c.length>1?app.btn(app.fa("arrow-up"),()=>e.open(r),"link float-right"):null,c];return t["p.pills"](f)}),app.views.edit_file=((e,t)=>(a,n)=>{let p=t.config.metadata||[];return[a.h4(t.key),n.appkit.form(a=>[t.config.name?a.fields({key:"name",required:!0,input:{"class":"form-control"},...t.config.name}):null,p.length?a.one("metadata",e=>e.fields(p.map(e=>{if(e.field){let t=e.field;return{...t,input:{"class":"form-control",...t.input},select:{"class":"form-control",...t.select},textarea:{"class":"form-control",...t.textarea}}}return e.tag}))):null,a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Update ${t.label}`,buttonTag:{"class":"btn btn-primary"}})],{data:t,action:`/api/${t.path}`,scope:"file",success:function(t){e.open(`/${t.path}`)}})]}),app.views.edit_dir=((e,t)=>(a,n)=>{let p=t.config.metadata||[];return[a.h4(t.dirname),n.appkit.form(a=>[t.config.name?a.fields({key:"name",required:!0,input:{"class":"form-control"},...t.config.name}):null,p.length?a.one("metadata",e=>e.fields(p.map(e=>{if(e.field){let t=e.field;return{...t,input:{"class":"form-control",...t.input},select:{"class":"form-control",...t.select},textarea:{"class":"form-control",...t.textarea}}}return e.tag}))):null,a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Update ${t.label}`,buttonTag:{"class":"btn btn-primary"}})],{data:t,action:`/api/${t.path}`,scope:"dir",success:function(t){e.open(`/${t.path}`)}})]}),app.views.renderer=((e,t)=>a=>a["app-view"]([app.views.error(e,t),app.views[t.type](e,t)])),app.views.resolver=(e=>(t,a)=>[a.then(a=>{t.$nodes=(()=>app.views.renderer(e,a))})["catch"](e=>{ax.log(e),t.$nodes=[(t,a)=>a.appkit.put(e.message)]})]),app.views.delete_dir=((e,t)=>(a,n)=>[a.h4(`Delete ${t.label}`),a.p(`Are you sure that you want to delete ${t.dirname}?`),n.appkit.form(a=>[a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Delete ${t.key}`,buttonTag:{"class":"btn btn-primary"}})],{method:"DELETE",action:`/api/${t.path}`,success:function(t){e.open(`/${t.path}`)}})]),app.views.new_file=((e,t)=>(a,n)=>{let p=t.config.metadata||[];return[a.h4(`New ${t.label}`),n.appkit.form(a=>[t.config.name?a.fields({key:"name",required:!0,input:{"class":"form-control"},...t.config.name}):null,p.length?[a.one("metadata",e=>e.fields(p.map(e=>{if(e.field){let t=e.field;return{...t,input:{"class":"form-control",...t.input},select:{"class":"form-control",...t.select},textarea:{"class":"form-control",...t.textarea}}}return e.tag})))]:null,a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path.replace("/~file","/~dir")}`)})," ",a.submit({icon:"fa fa-check",text:`Create ${t.label}`,buttonTag:{"class":"btn btn-primary"}})],{action:`/api/${t.path}/file`,scope:"file",success:function(t){e.open(`/${t.path}`)}})]}),app.views.error=function(){return e=>e["app-view-error"]({$show:function(t){this.$nodes(e.p(t,{"class":"alert alert-warning"}))}})},app.views.delete_file=((e,t)=>(a,n)=>[a.h4(`Delete ${t.label}`),a.p(["Are you sure that you want to delete",a.strong(t.filename),"?"]),n.appkit.form(a=>[a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Delete ${t.label}`,buttonTag:{"class":"btn btn-primary"}})],{method:"DELETE",action:`/api/${t.path}`,success:function(t){e.open(`/${t.path}`)}})]),app.views.new_dir=((e,t)=>(a,n)=>{let p=t.config.metadata||[];return[a.h4(`New ${t.label}`),n.appkit.form(a=>[t.config.name?a.fields({key:"name",required:!0,input:{"class":"form-control"},...t.config.name}):null,p.length?[a.one("metadata",e=>e.fields(p.map(e=>{if(e.field){let t=e.field;return{...t,input:{"class":"form-control",...t.input},select:{"class":"form-control",...t.select},textarea:{"class":"form-control",...t.textarea}}}return e.tag})))]:null,a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Create ${t.label}`,buttonTag:{"class":"btn btn-primary"}})],{action:`/api/${t.path}/subdir`,scope:"dir",success:function(t){e.open(`/${t.path}`)}})]}),app.views.edit_dir_order=((e,t)=>(a,n)=>[a.h4(`Order ${t.name}`),a.p([app.btn(app.fa("check","Done"),()=>e.open(`/${t.path}`))]),a.hr,a[".order-dir"](n.appkit.form(e=>[e.many("sort",p=>p.items([()=>n.html5sortable(t.entries.map(t=>a.li([e.input({name:"dir[order][]",value:t.name,type:"hidden"}),a["p.order-dir-item"]([app.fa("file"===t.type?"file-o":"folder",t.name),a.i(t.description)])])),{type:"ul",sortupdate:function(e,t){t.$("^form").$submit()}})]))],{onsubmit:(e,a)=>{n.appkit.http(`/api/${t.path}/order`,{body:a.$serialize(),method:"POST",success:()=>{}})}}))]),app.views.show_dir=((e,t)=>(a,n)=>[a.h4([t.dirname||t.label||"Home"," ",a.small(a.i(t.description))]),a.p([t.item&&t.item.edit?app.btn(app.fa("tag",t.label),()=>e.open(`${e.path}/edit`)):null,t.order?app.btn(app.fa("sort",`Order ${t.label}`),()=>e.open(`${e.path}/order/edit`)):null,t.collect.dirs&&t.collect.dirs["new"]?app.btn(app.fa("plus-square",`New ${t.collect.dirs.key}`),()=>e.open(`${e.path}/subdir/new`)):null,t.collect.files&&t.collect.files["new"]?app.btn(app.fa("plus-square-o",`New ${t.collect.files.key}`),()=>e.open(`${e.path}/file/new`)):null,t.item&&t.item["delete"]?app.btn(app.fa("trash",`Delete ${t.label}`),()=>e.open(`${e.path}/delete`),"link float-right"):null],{"class":"clearfix"}),t.metadata?app.views.show_dir.metadata(e,t):null,a.hr,t.entries.length?t.entries.map(t=>a.p([app.btn(app.fa("file"===t.type?"file-o":"folder",t.name),()=>e.open(`/${t.path}`)),a.i(t.description)])):a.i("No entries"),t.created?[a.hr,a["p.text-center"](a.small([a.label("Created")," ",n.timeago(t.created)]))]:null]),app.views.raw_file=((e,t)=>a=>[a.h4([t.filename," ",a.small(a.i(t.description))]),a.p([app.btn(app.fa("check","Done"),()=>e.open(`/${t.path}`)),app.btn(app.fa("code","Editor"),()=>e.open(`/${t.path}/raw/edit`))]),a.hr,a.pre(t.content)]),app.views.edit_raw_file=((e,t)=>(a,n)=>[a.h4([t.filename," ",a.small(a.i(t.description))]),n.appkit.form(a=>[a.fields({key:"contents",as:"code",label:!1,code:{mode:t.mode||""}}),a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Update ${t.label}`,buttonTag:{"class":"btn btn-primary"}})],{data:t,action:`/api/${t.path}/raw`,scope:"file",success:function(t){e.open(`/${t.path}`)}})]),app.views.show_file=((e,t)=>(a,n)=>[a.h4([t.filename," ",a.small(a.i(t.description))]),a.p([t.item&&t.item.edit?app.btn(app.fa("tag",t.label),()=>e.open(`${e.path}/edit`)):null,t.raw?app.btn(app.fa("file-text-o","Raw"),()=>e.open(`${e.path}/raw`)):null,t.editor?app.btn(app.fa("code","Editor"),()=>e.open(`${e.path}/raw/edit`)):null,t.item&&t.item["delete"]?app.btn(app.fa("trash",`Delete ${t.label}`),()=>e.open(`${e.path}/delete`),"link float-right"):null],{"class":"clearfix"}),t.error?[a.hr,a.p(t.error,{"class":"error"}),a.hr]:app.views.show_file.as(e,t),a["p.text-center"](a.small([t.created?[a.label("Created")," ",n.timeago(t.created)]:["Creation date unknown"],[a.label("Modified")," ",n.timeago(t.modified)]]))]),app.views.show_dir.metadata=((e,t)=>(e,a)=>{let n=[],p=t.metadata.as;if("link"===p){let a=t.link||{},p=a.href,i=a.label||"Open";n.push(e.hr,e.a(app.fa("external-link",i),{href:p,target:p,"class":"btn btn-link"}),e.hr)}else if("text"===p)n.push(e.hr,t.text.length?t.text:e.i("No content."),e.hr);else if("pre"===p)n.push(e.hr,t.text.length?t.text:e.i("No content."),e.hr);else if("list"===p){let e=t.metadata.object||{};n.push(a.appkit.list(e))}else"markdown"===p?n.push(e.hr,t.text.length?a.md(t.text):e.i("No content."),e.hr):"code"===p?n.push(a.codemirror.code(t.text,{mode:t.mode})):n.push(e.hr);return e.p(n)}),app.views.show_file.as=((e,t)=>(e,a)=>{let n=[];if("link"===t.as){let a=t.link||{},p=a.href,i=a.label||"Open";n.push(e.hr,e.a(app.fa("external-link",i),{href:p,target:p,"class":"btn btn-link"}),e.hr)}else"text"===t.as?n.push(e.hr,t.text.length?t.text:e.i("No content."),e.hr):"pre"===t.as?n.push(e.hr,t.text.length?t.text:e.i("No content."),e.hr):"list"===t.as?n.push(e.hr,Object.keys(t.object).length?a.appkit.list(t.object):e.i("No content."),e.hr):"markdown"===t.as?n.push(e.hr,t.text.length?a.md(t.text):e.i("No content."),e.hr):"code"===t.as?n.push(a.codemirror.code(t.text,{mode:t.mode})):n.push(e.hr);return e.p(n)});