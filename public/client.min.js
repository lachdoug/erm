"use strict";let app=function(e,t){return[app.css,t.appkit.router(a=>[app.navbar(a),e["div.container"](a.routes({"/sign_in":app.views.sign_in,"/volumes/**":app.views},{transition:t.appkit.transition.fade(t.appkit.loading,{time:200})}))],{"default":e=>t=>[t.p(`Not found ${e.path}`)]})]};app.navbar=(e=>t=>[t.h5([t.img({src:`/${(config.logo||{}).src||"logo.png"}`,height:(config.logo||{}).height||"",width:(config.logo||{}).width||""}),config.title||"ERM"]),t["div.container.clearfix"](e.routes({"%%":app.navbar.pills})),t.hr]),app.views=(e=>(t,a)=>a.appkit.http(`/api${e.path}`,{resolver:app.views.resolver(e)})),app.fa=function(e,t){return(a,n)=>n.appkit.icon(`fa fa-${e}`,t)},app.css=((e,t)=>t.appkit.document.css([{".error":{color:"red"},".pills":{padding:"0 0.375rem",".btn":{padding:"0 0.375rem"},".pill-selected":{border:"1px solid transparent",verticalAlign:"middle",padding:"0 0.375rem",color:"grey",lineHeight:"1.5",display:"inline-block"}},".order-dir":{ul:{listStyleType:"none",padding:0},".order-dir-item":{padding:".375rem 0",border:"1px solid transparent",cursor:"grab","appkit-icon":{padding:"0 0.75rem"}}},".bad-entry":{padding:".375rem .75rem",lineHeight:1.5,display:"inline-block",color:"red"},"appkit-list":{fontFamily:"monospace",whiteSpace:"pre",color:"lightgrey","appkit-list-type-null":{color:"red"},"appkit-list-type-number":{color:"green"},"appkit-list-type-text":{color:"blue",maxHeight:"300px",display:"inline-block"},"ul, ol":{padding:"0 0 0 20px"},label:{fontWeight:"bold",color:"grey",margin:"0px",verticalAlign:"top"}},".CodeMirror-scroll":{maxHeight:"80vh"},".fullscreen .CodeMirror-scroll":{maxHeight:"unset"},".file-open-iframe":{width:"100%",height:"80vh",border:"none"}},config.css||{}])),app.btn=function(e,t,a="link",n={}){return(i,p)=>p.appkit.button(e,t,{buttonTag:{disabled:n.disabled,"class":`btn btn-${a}`,...n.buttonTag}})},app.views.edit_file=((e,t)=>(a,n)=>{let i=t.config.metadata||[];return[a.h3(`Edit ${t.label}`),n.appkit.form(a=>[t.config.name?a.fields({key:"name",required:!0,input:{"class":"form-control"},...t.config.name}):null,i.length?a.one("metadata",e=>e.fields(i.map(e=>{if(e.field){let t=e.field;return{...t,input:{"class":"form-control",...t.input},select:{"class":"form-control",...t.select},textarea:{"class":"form-control",...t.textarea}}}return e.tag}))):null,a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Update ${t.type}`,buttonTag:{"class":"btn btn-primary"}}),,],{data:t,action:`/api/${t.path}`,scope:"file",success:function(t){e.open(`/${t.path}`)}})]}),app.views.edit_dir=((e,t)=>(a,n)=>{let i=t.config.metadata||[];return[a.h3(`Edit ${t.label}`),n.appkit.form(a=>[t.config.name?a.fields({key:"name",required:!0,input:{"class":"form-control"},...t.config.name}):null,i.length?a.one("metadata",e=>e.fields(i.map(e=>{if(e.field){let t=e.field;return{...t,input:{"class":"form-control",...t.input},select:{"class":"form-control",...t.select},textarea:{"class":"form-control",...t.textarea}}}return e.tag}))):null,a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Update ${t.type}`,buttonTag:{"class":"btn btn-primary"}}),,],{data:t,action:`/api/${t.path}`,scope:"dir",success:function(t){e.open(`/${t.path}`)}})]}),app.views.renderer=((e,t)=>a=>a["app-view"]([app.views.sign_out(e),app.views[t.view](e,t)])),app.views.sign_out=(e=>(t,a)=>t["app-sign-out"](app.btn(app.fa("sign-out","Sign out"),(t,n)=>n.$("^").$nodes(a.appkit.http("/api/session",{method:"DELETE",success:()=>{app.views.sign_in.redirect=e.path,e.open("/sign_in")}}))),{"class":"pull-right"})),app.views.resolver=(e=>t=>(a,n)=>[n.then(t=>{a.$nodes=(()=>app.views.renderer(e,t))})["catch"](n=>{ax.log(n),a.$nodes=[(e,t)=>t.appkit.put(n.message),401===t.status?app.btn(app.fa("sign-in","Sign in"),()=>e.open("/sign_in")):null]})]),app.views.delete_dir=((e,t)=>(a,n)=>[a.h3(`Delete ${t.label}`),a.p(["Are you sure that you want to delete the directory ",a.strong(t.dirname)," and all its contents?"]),n.appkit.form(a=>[a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Delete ${t.type}`,buttonTag:{"class":"btn btn-primary"}})],{method:"DELETE",action:`/api/${t.path}`,success:function(t){e.open(`/${t.path}`)}})]),app.views.new_file=((e,t)=>(a,n)=>{let i=t.config.metadata||[];return[a.h3(`New ${t.type}`),n.appkit.form(a=>[t.config.name?a.fields({key:"name",required:!0,input:{"class":"form-control"},...t.config.name}):null,i.length?[a.one("metadata",e=>e.fields(i.map(e=>{if(e.field){let t=e.field;return{...t,input:{"class":"form-control",...t.input},select:{"class":"form-control",...t.select},textarea:{"class":"form-control",...t.textarea}}}return e.tag})))]:null,a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path.replace("/~file","/~dir")}`)})," ",a.submit({icon:"fa fa-check",text:`Create ${t.type}`,buttonTag:{"class":"btn btn-primary"}})],{action:`/api/${t.path}/file`,scope:"file",success:function(t){e.open(`/${t.path}`)}})]}),app.views.delete_file=((e,t)=>(a,n)=>[a.h3(`Delete ${t.label}`),a.p(["Are you sure that you want to delete the file",a.strong(t.filename),"?"]),n.appkit.form(a=>[a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Delete ${t.type}`,buttonTag:{"class":"btn btn-primary"}})],{method:"DELETE",action:`/api/${t.path}`,success:function(t){e.open(`/${t.path}`)}})]),app.views.new_dir=((e,t)=>(a,n)=>{let i=t.config.metadata||[];return[a.h3(`New ${t.type}`),n.appkit.form(a=>[t.config.name?a.fields({key:"name",required:!0,input:{"class":"form-control"},...t.config.name}):null,i.length?[a.one("metadata",e=>e.fields(i.map(e=>{if(e.field){let t=e.field;return{...t,input:{"class":"form-control",...t.input},select:{"class":"form-control",...t.select},textarea:{"class":"form-control",...t.textarea}}}return e.tag})))]:null,a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Create ${t.type}`,buttonTag:{"class":"btn btn-primary"}})],{action:`/api/${t.path}/subdir`,scope:"dir",success:function(t){e.open(`/${t.path}`)}})]}),app.views.edit_dir_order=((e,t)=>(a,n)=>[a.h3(`Order ${t.label}`),a.p([app.btn(app.fa("check","Done"),()=>e.open(`/${t.path}`))]),a.hr,a[".order-dir"](n.appkit.form(e=>[e.many("sort",i=>i.items([()=>n.html5sortable(t.entries.map(t=>a.li([e.input({name:"dir[order][]",value:t.name,type:"hidden"}),a["p.order-dir-item"]([app.fa("file"===t.entry_type?"file-o":"folder",t.label),a.i(t.description)])])),{type:"ul",sortupdate:function(e,t){t.$("^form").$submit()}})]))],{onsubmit:(e,a)=>{n.appkit.http(`/api/${t.path}/order`,{body:a.$serialize(),method:"POST",success:()=>{}})}}))]),app.views.sign_in=(e=>(t,a)=>t["app-sign-in"]([t.h3("Authentication"),a.appkit.form(e=>[e.fields({key:"token",type:"password",label:!1,placeholder:"Token",input:{"class":"form-control"},confirm:!1}),e.submit({icon:"fa fa-sign-in",text:"Sign in",buttonTag:{"class":"btn btn-primary"}})],{action:"/api/session",success:function(){return e.open(app.views.sign_in.redirect),!0}})])),app.views.show_dir=((e,t)=>(a,n)=>[a.h3([t.label," ",a.small(a.i(t.description))]),a.p([t.item&&t.item.edit?app.btn(app.fa("tag",t.type),()=>e.open(`${e.path}/edit`)):null,t.order?app.btn(app.fa("sort",`Order ${t.label}`),()=>e.open(`${e.path}/order/edit`)):null,t.collect.dirs&&t.collect.dirs["new"]?app.btn(app.fa("plus-square",`New ${t.collect.dirs.type}`),()=>e.open(`${e.path}/subdir/new`)):null,t.collect.files&&t.collect.files["new"]?app.btn(app.fa("plus-square-o",`New ${t.collect.files.type}`),()=>e.open(`${e.path}/file/new`)):null,t.item&&t.item["delete"]?app.btn(app.fa("trash",`Delete ${t.type}`),()=>e.open(`${e.path}/delete`),"link float-right"):null],{"class":"clearfix"}),app.views.show_dir.fixes(e,t),t.metadata?app.views.show_dir.metadata(e,t):null,a.hr,t.entries.length?t.entries.map(t=>app.views.show_dir.entry(e,t)):a.i("No entries"),t.created?[a.hr,a["p.text-center"](a.small([a.label("Created")," ",n.timeago(t.created)]))]:null]),app.views.raw_file=((e,t)=>a=>[a.h3([t.filename," ",a.small(a.i(t.description))]),a.p([app.btn(app.fa("check","Done"),()=>e.open(`/${t.path}`)),app.btn(app.fa("code","Editor"),()=>e.open(`/${t.path}/raw/edit`))]),a.hr,a.pre(t.content)]),app.views.edit_raw_file=((e,t)=>(a,n)=>[a.h3([t.label," ",a.small(a.i(t.description))]),n.appkit.form(a=>[a.fields({key:"contents",as:"code",label:!1,code:{mode:t.mode||""}}),a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:`Update ${t.type}`,buttonTag:{"class":"btn btn-primary"}})],{data:t,action:`/api/${t.path}/raw`,scope:"file",success:function(t){e.open(`/${t.path}`)}})]),app.views.bad_entries=((e,t)=>(a,n)=>{let i=t.entries,p="missing"===t.problem?"Add missing entries?":"Remove unknown entries?",o="missing"===t.problem?"Create entries?":"Delete entries?";return[a.h3(t.dirname),p,a.ul(i.map(function(e){return a.li(e)})),n.appkit.form(a=>[a.button({icon:"fa fa-times",text:"Cancel",buttonTag:{"class":"btn btn-secondary"},onclick:()=>e.open(`/${t.path}`)})," ",a.submit({icon:"fa fa-check",text:o,buttonTag:{"class":"btn btn-primary"}})],{data:t,action:`/api/${t.path}/${t.problem}`,success:function(t){e.open(`/${t.path}`)}})]}),app.views.show_file=((e,t)=>(a,n)=>[a.h3([t.label," ",a.small(a.i(t.description))]),a.p([t.item&&t.item.edit?app.btn(app.fa("tag",t.type),()=>e.open(`${e.path}/edit`)):null,t.raw?app.btn(app.fa("file-text-o","Raw"),()=>e.open(`${e.path}/raw`)):null,t.editor?app.btn(app.fa("code","Editor"),()=>e.open(`${e.path}/raw/edit`)):null,t.item&&t.item["delete"]?app.btn(app.fa("trash",`Delete ${t.type}`),()=>e.open(`${e.path}/delete`),"link float-right"):null],{"class":"clearfix"}),t.error?[a.hr,a.p(t.error,{"class":"error"}),a.hr]:app.views.show_file.as(e,t),a["p.text-center"](a.small([t.created?["Created",n.timeago(t.created)]:["Creation date unknown"],["Modified",n.timeago(t.modified)]]))]),app.navbar.pills=(e=>t=>{let a,n,i,p,o=e.path.replace(/^\/volumes/,"").match(/^((.*)\/~(dir|subdir|file))(.*)$/);o?(a=o[2],n=o[3],i=o[4],p=a.split("/")):(a="/",n="dir",i="",p=[""]);let r,l="",s=[],c=p.length-1;p.forEach((a,p)=>{let o,d=`${l}${a}`;if(0===p&&p===c)o=t[".pill-selected"](app.fa("home"));else if(0===p)o=app.btn(app.fa("home"),()=>e.open("/volumes/~dir"));else if(p===c){let p="dir"===n?"folder":"file-o";i?(o=app.btn(app.fa(p,decodeURIComponent(a)),()=>e.open(`/volumes${d}/~${n}`)),r=`/volumes${d}/~${n}`):(o=t[".pill-selected"](app.fa(p,decodeURIComponent(a))),r=`/volumes${l}~dir`)}else o=app.btn(app.fa("folder",decodeURIComponent(a)),()=>e.open(`/volumes${d}/~dir`));s.push(o),l=`${d}/`});let d=[s.length>1?app.btn(app.fa("arrow-up"),()=>e.open(r),"link float-right"):null,s];return t["p.pills"](d)}),app.views.sign_in.redirect="/volumes/~dir",app.views.show_dir.fixes=function(e,t){let a=t.entries.some(function(e){return"unknown"===e.status}),n=t.entries.some(function(e){return"missing"===e.status});return a||n?t=>t.p([t.hr(),a?app.btn(app.fa("minus-square","Remove unknown"),()=>e.open(`${e.path}/unknown`),"link float-right"):null,n?app.btn(app.fa("plus-square","Add missing"),()=>e.open(`${e.path}/missing`),"link"):null],{"class":"clearfix"}):null},app.views.show_dir.metadata=((e,t)=>(e,a)=>{let n=[],i=t.metadata.as;if("link"===i){let a=t.link||{},i=a.href,p=a.label||"Open";n.push(e.hr,e.a(app.fa("external-link",p),{href:i,target:i,"class":"btn btn-link"}),e.hr)}else if("text"===i)n.push(e.hr,t.text.length?t.text:e.i("No content."),e.hr);else if("pre"===i)n.push(e.hr,t.text.length?t.text:e.i("No content."),e.hr);else if("list"===i){let e=t.metadata.object||{};n.push(a.appkit.list(e))}else"markdown"===i?n.push(e.hr,t.text.length?a.md(t.text):e.i("No content."),e.hr):"code"===i?n.push(a.codemirror.code(t.text,{mode:t.mode})):n.push(e.hr);return e.p(n)}),app.views.show_dir.entry=function(e,t){return"present"===t.status?a=>a.p([app.btn(app.fa(app.views.show_dir.entry.icon(t),t.label),()=>e.open(`/${t.path}`)),a.i(t.description)]):e=>e.p([e[".bad-entry"](app.fa(app.views.show_dir.entry.icon(t),t.label)),e.i(t.description)])},app.views.show_file.as=((e,t)=>(e,a)=>{let n=[];if("link"===t.as){let a=t.link||{},i=a.href,p=a.label||"Link";n.push(e.hr,e.a(app.fa("external-link",p),{href:i,target:i,"class":"btn btn-link"}),e.hr)}else"iframe"===t.as?n.push(`/open/${t.path}`,e.iframe({src:`/iframe/${t.path}`,"class":"file-open-iframe"}),e.p("Hi"),e.hr):"text"===t.as?n.push(e.hr,t.text.length?t.text:e.i("No content."),e.hr):"pre"===t.as?n.push(e.hr,t.text.length?t.text:e.i("No content."),e.hr):"list"===t.as?n.push(e.hr,Object.keys(t.object).length?a.appkit.list(t.object):e.i("No content."),e.hr):"markdown"===t.as?n.push(e.hr,t.text.length?a.md(t.text):e.i("No content."),e.hr):"code"===t.as?n.push(a.codemirror.code(t.text,{mode:t.mode})):n.push(e.hr);return e.p(n)}),app.views.show_dir.entry.icon=function(e){return"file"===e.entry_type?"missing"===e.status?"exclamation":"unknown"===e.status?"question":"file-o":"missing"===e.status?"exclamation-circle":"unknown"===e.status?"question-circle":"folder"};